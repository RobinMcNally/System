export LC_ALL=en_US.UTF-8
export LANG=en_US.UTF-8

export PATH=$PATH:$HOME/System/scripts
export EDITOR=vim

stty -ixon # Keep Ctrl-s from freezing the terminal

#if [ -f ~/.force-shell ] && [ "$SHELL" != "$(cat $HOME/.force-shell)" ]; then
#    real_shell=`cat $HOME/.force-shell`
#    echo "Forcing shell: $real_shell."
#    exec `$real_shell` SHELL=$real_shell && exit
#fi

if [ -n "$SSH_CONNECTION" ] && \
   [ -z "$TMUX" ] && \
   [ -n "$SSH_TTY" ] && \
   [ -z "$NO_TMUX" ] && \
   [ "$TERM" != "mobile" ];
then
    if [ -n "$TMUX_SESSION" ]; then
        session="$TMUX_SESSION"
    else
        session="$USER"
    fi

    which tmux >/dev/null 2>/dev/null
    if [ $? -eq 0 ]; then
        tmux new-session -A -s "$session" # Create or attach to existing session.
        exit
    fi
fi

# The "mobile" terminal type apparently exists, and is incredibly dumb. Therefore, switch back to something sane.
if [ "$TERM" = "mobile" ]; then
    export TERM=xterm-256color
    clear # Yay even more hacky. This fixes the visual corruption that happens right after mobile connect.
fi
